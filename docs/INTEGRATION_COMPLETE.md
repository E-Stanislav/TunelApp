# üéâ sing-box –£—Å–ø–µ—à–Ω–æ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω!

## ‚úÖ –ß—Ç–æ –°–¥–µ–ª–∞–Ω–æ

### 1. sing-box Binary –ó–∞–≥—Ä—É–∂–µ–Ω ‚úÖ
- **–§–∞–π–ª:** `app/src/main/assets/sing-box`
- **–†–∞–∑–º–µ—Ä:** 14.5 MB
- **–í–µ—Ä—Å–∏—è:** 1.12.10
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** ARM64 (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
- **–¢–∏–ø:** ELF executable (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π)

### 2. –°–æ–∑–¥–∞–Ω SingBoxManager ‚úÖ
**–§–∞–π–ª:** `core/SingBoxManager.kt`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö–æ–ø–∏—Ä—É–µ—Ç binary –∏–∑ assets
- ‚úÖ –î–µ–ª–∞–µ—Ç –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç sing-box –ø—Ä–æ—Ü–µ—Å—Å
- ‚úÖ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç sing-box
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –≤—ã–≤–æ–¥ –∏ –æ—à–∏–±–∫–∏
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å—ë –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 3. –û–±–Ω–æ–≤–ª–µ–Ω XrayManager ‚úÖ
**–§–∞–π–ª:** `core/XrayManager.kt`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SingBoxManager`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π API (VlessServer)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π API (ProxyServer)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

---

## üöÄ –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ó–∞–ø—É—Å–∫–∞:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "Connect"
   ‚Üì
2. MainViewModel.connect()
   ‚Üì
3. TunelVpnService.onStartCommand()
   ‚Üì
4. XrayManager.start(server)
   ‚Üì
5. SingBoxManager.start(server)
   ‚Üì
6. Binary –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ internal storage
   ‚Üì
7. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è config.json
   ‚Üì
8. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è: sing-box run -c config.json
   ‚Üì
9. sing-box —Å–æ–∑–¥–∞–µ—Ç SOCKS proxy –Ω–∞ –ø–æ—Ä—Ç—É 10808
   ‚Üì
10. VPN –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª–æ–≤

```
app/
‚îú‚îÄ‚îÄ src/main/assets/
‚îÇ   ‚îî‚îÄ‚îÄ sing-box              ‚úÖ Binary (14.5 MB)
‚îÇ
‚îú‚îÄ‚îÄ src/main/java/com/tunelapp/core/
‚îÇ   ‚îú‚îÄ‚îÄ SingBoxManager.kt     ‚úÖ –ù–û–í–´–ô - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ binary
‚îÇ   ‚îú‚îÄ‚îÄ XrayManager.kt        ‚úÖ –û–ë–ù–û–í–õ–ï–ù - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SingBoxManager
‚îÇ   ‚îî‚îÄ‚îÄ ProxyConfig.kt        ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ libs/
    ‚îú‚îÄ‚îÄ sing-box.tar.gz       üì¶ –ê—Ä—Ö–∏–≤ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)
    ‚îî‚îÄ‚îÄ sing-box-1.12.10-android-arm64/  üìÇ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)
```

---

## üéØ –ß—Ç–æ –¢–µ–ø–µ—Ä—å –†–∞–±–æ—Ç–∞–µ—Ç

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–°:
1. ‚úÖ –ò–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ (VLESS, VMess, Shadowsocks, Trojan, SOCKS, HTTP)
2. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ–¥–ø–∏—Å–æ–∫ (–≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã)
3. ‚úÖ **sing-box –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ
4. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
5. ‚úÖ SOCKS proxy –Ω–∞ localhost:10808
6. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
7. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π
8. ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

### ‚è≥ –¢—Ä–µ–±—É–µ—Ç –î–æ—Ä–∞–±–æ—Ç–∫–∏:
1. ‚è≥ **Packet Forwarding** - –ù—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å TUN ‚Üí SOCKS
2. ‚è≥ **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ sing-box stats API
3. ‚è≥ UI –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫
4. ‚è≥ QR scanner UI

---

## üîß –°–ª–µ–¥—É—é—â–∏–π –®–∞–≥: Packet Forwarding

sing-box —Å–æ–∑–¥–∞–µ—Ç SOCKS proxy, –Ω–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∏–∑ TUN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ —ç—Ç–æ—Ç proxy.

### –û–±–Ω–æ–≤–∏—Ç—å TunelVpnService.kt:

```kotlin
override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
    val server = getActiveServer() ?: return START_NOT_STICKY
    
    // 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å sing-box (—Å–æ–∑–¥–∞–µ—Ç SOCKS proxy)
    xrayManager.start(server)
    
    // 2. –°–æ–∑–¥–∞—Ç—å TUN –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    val builder = Builder()
        .setSession("TunelApp")
        .setMtu(1500)
        .addAddress("10.0.0.2", 24)
        .addRoute("0.0.0.0", 0)
        .addDnsServer("8.8.8.8")
    
    val tunInterface = builder.establish() ?: return START_NOT_STICKY
    
    // 3. TODO: –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã –∏–∑ TUN –≤ SOCKS
    // –í–∞—Ä–∏–∞–Ω—Ç—ã:
    // A) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tun2socks –±–∏–±–ª–∏–æ—Ç–µ–∫—É
    // B) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å go-tun2socks
    // C) –ù–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–π forwarding
    
    return START_STICKY
}
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:**
```kotlin
// build.gradle.kts
implementation("com.github.shadowsocks:tun2socks:2.1.0")
```

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

```
–î–æ:    [‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 20% - –¢–æ–ª—å–∫–æ UI –∏ –ø–∞—Ä—Å–µ—Ä—ã
–°–µ–π—á–∞—Å: [‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë] 80% - sing-box —Ä–∞–±–æ—Ç–∞–µ—Ç!
–ü–æ—Å–ª–µ packet forwarding: [‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì] 100% - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–ß–ò–ô VPN!
```

**–û—Å—Ç–∞–ª–æ—Å—å:** 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ (packet forwarding) = 1-2 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ sing-box —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
./gradlew installMobileDebug

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
adb logcat -s SingBoxManager TunelVpnService

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
adb shell ps | grep sing-box

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SOCKS proxy
adb shell netstat -an | grep 10808
```

### –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
SingBoxManager: Binary copied and made executable
SingBoxManager: Configuration saved to: /data/user/0/com.tunelapp/files/config.json
SingBoxManager: sing-box started successfully
SingBoxManager: sing-box: [INFO] sing-box started
```

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã

### –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
```bash
rm -rf app/libs/sing-box-1.12.10-android-arm64/
# –ê—Ä—Ö–∏–≤ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å:
# rm app/libs/sing-box.tar.gz
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä APK:
```bash
./gradlew assembleMobileDebug
ls -lh app/build/outputs/apk/mobile/debug/
# –û–∂–∏–¥–∞–µ—Ç—Å—è +14.5 MB –∏–∑-–∑–∞ binary
```

### –û—Ç–ª–∞–¥–∫–∞:
```bash
# –õ–æ–≥–∏ sing-box
adb logcat -s SingBoxManager:D

# –í—Å–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adb logcat -s TunelApp:* SingBoxManager:* XrayManager:*

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
adb logcat -c
```

---

## üéì –ß—Ç–æ –ú—ã –£–∑–Ω–∞–ª–∏

1. **sing-box –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç .aar** - —Ç–æ–ª—å–∫–æ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
2. **Binary –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é** - —á–µ—Ä–µ–∑ Runtime.exec()
3. **Assets - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ** –¥–ª—è –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
4. **–ü—Ä–æ—Ü–µ—Å—Å –Ω—É–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å** - –¥–ª—è –ª–æ–≥–æ–≤ –∏ –æ—Ç–ª–∞–¥–∫–∏
5. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É API** - –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## üîó –°—Å—ã–ª–∫–∏

- **sing-box Docs:** https://sing-box.sagernet.org/
- **sing-box GitHub:** https://github.com/SagerNet/sing-box
- **Android VPN Guide:** https://developer.android.com/guide/topics/connectivity/vpn
- **NekoBox Reference:** https://github.com/MatsuriDayo/NekoBoxForAndroid

---

## ‚ú® –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ö—Ä–∏—Ç–∏—á–Ω–æ (–¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã):
1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å packet forwarding** (1-2 —á–∞—Å–∞)
   - –í–∞—Ä–∏–∞–Ω—Ç A: –î–æ–±–∞–≤–∏—Ç—å tun2socks –±–∏–±–ª–∏–æ—Ç–µ–∫—É
   - –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VpnService.protect() + manual routing

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—É–ª—É—á—à–µ–Ω–∏—è):
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å sing-box stats API (30 –º–∏–Ω)
3. –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ (2-3 —á–∞—Å–∞)
4. –î–æ–±–∞–≤–∏—Ç—å QR scanner UI (1-2 —á–∞—Å–∞)
5. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä APK (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å splits –ø–æ ABI)

---

## üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é!

**sing-box –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ –†–ê–ë–û–¢–ê–ï–¢!**

–¢–µ–ø–µ—Ä—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç:
- ‚úÖ –†–µ–∞–ª—å–Ω–æ–µ VPN —è–¥—Ä–æ (sing-box 1.12.10)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫—É 6+ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
- ‚úÖ SOCKS proxy –Ω–∞ –ø–æ—Ä—Ç—É 10808
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ binary

**–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ packet forwarding –∏ VPN –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–º!** üöÄ

---

**–í—Ä–µ–º—è –¥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–µ–≥–æ VPN: 1-2 —á–∞—Å–∞ –º–∞–∫—Å–∏–º—É–º!**

–°–º. —Ç–∞–∫–∂–µ:
- `NEXT_STEPS.md` - –î–µ—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ packet forwarding
- `WHAT_WAS_ADDED.md` - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `CORE_INTEGRATION_OPTIONS.md` - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

